generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                @id @default(uuid())
  clerkId                 String                @unique
  email                   String                @unique
  name                    String
  avatar                  String?
  headline                String?
  bio                     String?
  location                String?
  university              String?
  graduationYear          Int?
  skills                  String[]              @default([])
  interests               String[]              @default([])
  connections             Int                   @default(0)
  profileViews            Int                   @default(0)
  searchAppearances       Int                   @default(0)
  completedProjects       Int                   @default(0)
  visibility              String                @default("public")
  isProfileComplete       Boolean               @default(false)
  linkedinUrl             String?
  githubUrl               String?
  portfolioUrl            String?
  lastViewedAt            DateTime?
  lastLoginAt             DateTime?
  lastUpdatedBy           String?
  profileUpdatedAt        DateTime?
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  achievements            Achievement[]
  analyticsData           AnalyticsData?
  applications            Application[]
  receivedConnections     Connection[]          @relation("ConnectionReceiver")
  sentConnections         Connection[]          @relation("ConnectionRequester")
  extracurriculars        Extracurricular[]
  receivedMessages        Message[]             @relation("ReceivedMessages")
  sentMessages            Message[]             @relation("SentMessages")
  ownedProjects           Project[]             @relation("ProjectOwner")
  projects                ProjectCollaborator[]
  recommendationsGiven    Recommendation[]      @relation("GivenRecommendations")
  recommendationsReceived Recommendation[]      @relation("ReceivedRecommendations")
  goals                   UserGoal[]
  savedOpportunities      UserOpportunity[]
  socialLinks             SocialLink[]
  activities              UserActivity[]
  endorsementsGiven       SkillEndorsement[]    @relation("EndorsementGiver")
  endorsementsReceived    SkillEndorsement[]    @relation("EndorsementReceiver")
  eventRegistrations      EventRegistration[]
  preferences             UserPreferences?
  userProfile             UserProfile?
  chatSession             ChatSession?

  @@index([email])
  @@index([visibility])
}

model Recommendation {
  id           String   @id @default(uuid())
  content      String
  authorId     String
  receiverId   String
  authorName   String
  authorRole   String
  authorAvatar String?
  date         String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  author       User     @relation("GivenRecommendations", fields: [authorId], references: [id], onDelete: Cascade)
  receiver     User     @relation("ReceivedRecommendations", fields: [receiverId], references: [id], onDelete: Cascade)
}

model SocialLink {
  id        String   @id @default(uuid())
  userId    String
  platform  String
  url       String
  isVisible Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, platform])
  @@index([platform])
}

model Opportunity {
  id                   String            @id @default(uuid())
  title                String
  company              String
  location             String
  type                 String
  deadline             DateTime?
  postedDate           DateTime          @default(now())
  logo                 String?
  skills               String[]          @default([])
  description          String
  salary               String?
  duration             String?
  remote               Boolean           @default(false)
  applicants           Int               @default(0)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  category             String            @default("Other")
  extractionConfidence Float             @default(0.0)
  isActive             Boolean           @default(true)
  requirements         String?
  sourceUrl            String?
  url                  String?
  lastVerified         DateTime?
  recheckAt            DateTime?
  timingType           String            @default("one-time")
  isExpired            Boolean           @default(false)
  nextCycleExpected    DateTime?
  userOpportunities    UserOpportunity[]
}

model UserOpportunity {
  id            String      @id @default(uuid())
  userId        String
  opportunityId String
  matchScore    Int         @default(0)
  matchReasons  Json        @default("[]")
  status        String      @default("curated")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, opportunityId])
}

model UserGoal {
  id        String   @id @default(uuid())
  userId    String
  goalText  String
  roadmap   Json     @default("[]")
  filters   Json?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Project {
  id            String                @id @default(uuid())
  title         String
  description   String
  image         String?
  category      String                @default("Other")
  status        String                @default("Planning")
  visibility    String                @default("public")
  likes         Int                   @default(0)
  views         Int                   @default(0)
  comments      Int                   @default(0)
  tags          String[]              @default([])
  progress      Int                   @default(0)
  links         Json                  @default("[]")
  lookingFor    String[]              @default([])
  ownerId       String
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  owner         User                  @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  collaborators ProjectCollaborator[]
  updates       ProjectUpdate[]

  @@index([category])
  @@index([ownerId])
  @@index([visibility])
}

model ProjectCollaborator {
  id        String  @id @default(uuid())
  projectId String
  userId    String
  role      String  @default("Collaborator")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
}

model ProjectUpdate {
  id        String   @id @default(uuid())
  projectId String
  type      String
  content   String
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Connection {
  id                String    @id @default(uuid())
  requesterId       String
  receiverId        String
  status            String    @default("pending")
  mutualConnections Int       @default(0)
  matchReason       String?
  connectedDate     DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  receiver          User      @relation("ConnectionReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  requester         User      @relation("ConnectionRequester", fields: [requesterId], references: [id], onDelete: Cascade)

  @@unique([requesterId, receiverId])
}

model Message {
  id         String   @id @default(uuid())
  content    String
  senderId   String
  receiverId String
  preview    String?
  unread     Boolean  @default(true)
  createdAt  DateTime @default(now())
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
}

model Application {
  id          String   @id @default(uuid())
  company     String
  position    String
  status      String   @default("Applied")
  appliedDate DateTime @default(now())
  nextStep    String?
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Event {
  id            String              @id @default(uuid())
  title         String
  date          String
  location      String
  type          String
  attendees     Int                 @default(0)
  image         String?
  description   String?
  matchScore    Int                 @default(0)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  registrations EventRegistration[]
}

model Achievement {
  id        String   @id @default(uuid())
  title     String
  date      String
  icon      String
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Extracurricular {
  id           String   @id @default(uuid())
  title        String
  organization String
  type         String
  startDate    String
  endDate      String
  description  String?
  logo         String?
  userId       String
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AnalyticsData {
  id                String   @id @default(uuid())
  userId            String   @unique
  profileViews      Json     @default("[]")
  networkGrowth     Json     @default("[]")
  skillEndorsements Json     @default("[]")
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserActivity {
  id        String   @id @default(uuid())
  userId    String
  type      String
  metadata  Json?
  date      DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
}

model SkillEndorsement {
  id          String   @id @default(uuid())
  skill       String
  endorserId  String
  endorseeId  String
  createdAt   DateTime @default(now())
  endorser    User     @relation("EndorsementGiver", fields: [endorserId], references: [id], onDelete: Cascade)
  endorsee    User     @relation("EndorsementReceiver", fields: [endorseeId], references: [id], onDelete: Cascade)

  @@unique([endorserId, endorseeId, skill])
  @@index([endorseeId, skill])
}

model EventRegistration {
  id        String   @id @default(uuid())
  userId    String
  eventId   String
  status    String   @default("registered")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
  @@index([userId])
  @@index([eventId])
}

model UserPreferences {
  id                  String   @id @default(uuid())
  userId              String   @unique
  notifyOpportunities Boolean  @default(true)
  notifyConnections   Boolean  @default(true)
  notifyMessages      Boolean  @default(true)
  weeklyDigest        Boolean  @default(false)
  publicProfile       Boolean  @default(true)
  showActivityStatus  Boolean  @default(false)
  showProfileViews    Boolean  @default(true)
  aiSuggestions       Boolean  @default(true)
  autoIcebreakers     Boolean  @default(true)
  careerNudges        Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ChatLog {
  id        String   @id @default(uuid())
  userId    String
  message   String
  role      String
  createdAt DateTime @default(now())
}

model UserProfile {
  id                          String   @id @default(uuid())
  userId                      String   @unique
  interests                   String[] @default([])
  location                    String?
  grade_level                 Int?
  career_goals                String?
  preferred_opportunity_types String[] @default([])
  academic_strengths          String[] @default([])
  availability                String?
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt
  user                        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ChatSession {
  id        String   @id @default(uuid())
  userId    String   @unique
  title     String?
  messages  Json     @default("[]")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
